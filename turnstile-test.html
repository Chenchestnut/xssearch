<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turnstile æ¸¬è©¦</title>
    <link rel="preconnect" href="https://challenges.cloudflare.com">
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
</head>
<body>
    <h1>Cloudflare Turnstile æ¸¬è©¦</h1>
    
    <form id="test-form">
        <div>
            <label>æ¸¬è©¦è¼¸å…¥ï¼š</label>
            <input type="text" name="test" placeholder="è¼¸å…¥æ¸¬è©¦å…§å®¹" required>
        </div>
        
        <!-- Turnstile å°å·¥å…· -->
        <div id="turnstile-widget"></div>
        
        <button type="submit" id="submit-btn" disabled>æäº¤</button>
    </form>
    
    <div id="result"></div>

    <script>
        let turnstileToken = null;
        
        // Turnstile æˆåŠŸå›èª¿
        function onTurnstileSuccess(token) {
            console.log('âœ… Turnstile é©—è­‰æˆåŠŸ:', token);
            turnstileToken = token;
            document.getElementById('submit-btn').disabled = false;
            document.getElementById('result').innerHTML = '<p style="color: green;">âœ… Turnstile é©—è­‰æˆåŠŸï¼</p>';
        }
        
        // Turnstile éŒ¯èª¤å›èª¿
        function onTurnstileError(errorCode) {
            console.error('âŒ Turnstile éŒ¯èª¤:', errorCode);
            turnstileToken = null;
            document.getElementById('submit-btn').disabled = true;
            document.getElementById('result').innerHTML = `<p style="color: red;">âŒ Turnstile éŒ¯èª¤: ${errorCode}</p>`;
        }
        
        // Turnstile éæœŸå›èª¿
        function onTurnstileExpired() {
            console.warn('âš ï¸ Turnstile token éæœŸ');
            turnstileToken = null;
            document.getElementById('submit-btn').disabled = true;
            document.getElementById('result').innerHTML = '<p style="color: orange;">âš ï¸ Turnstile token å·²éæœŸ</p>';
        }
        
        // ç­‰å¾… Turnstile è¼‰å…¥
        function waitForTurnstile() {
            return new Promise((resolve) => {
                const check = () => {
                    if (window.turnstile) {
                        resolve();
                    } else {
                        setTimeout(check, 100);
                    }
                };
                check();
            });
        }
        
        // åˆå§‹åŒ– Turnstile
        async function initTurnstile() {
            try {
                console.log('ğŸš€ ç­‰å¾… Turnstile è¼‰å…¥...');
                await waitForTurnstile();
                
                console.log('âœ… Turnstile å·²è¼‰å…¥');
                console.log('ğŸ”‘ Site Key: 0x4AAAAAAA3QtOGlz4UGnf74');
                console.log('ğŸŒ ç•¶å‰åŸŸå:', window.location.hostname);
                console.log('ğŸ”— ç•¶å‰ URL:', window.location.href);
                
                const widgetId = window.turnstile.render('#turnstile-widget', {
                    sitekey: '0x4AAAAAAA3QtOGlz4UGnf74',
                    callback: onTurnstileSuccess,
                    'error-callback': onTurnstileError,
                    'expired-callback': onTurnstileExpired,
                    theme: 'light',
                    size: 'normal'
                });
                
                console.log('ğŸ¯ Widget ID:', widgetId);
                
            } catch (error) {
                console.error('âŒ Turnstile åˆå§‹åŒ–éŒ¯èª¤:', error);
                document.getElementById('result').innerHTML = `<p style="color: red;">âŒ Turnstile åˆå§‹åŒ–å¤±æ•—: ${error.message}</p>`;
            }
        }
        
        // è¡¨å–®æäº¤è™•ç†
        document.getElementById('test-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!turnstileToken) {
                alert('è«‹å…ˆå®Œæˆ Turnstile é©—è­‰ï¼');
                return;
            }
            
            console.log('ğŸ“¤ æäº¤è¡¨å–®ï¼ŒToken:', turnstileToken);
            
            try {
                // æ¸¬è©¦å¾Œç«¯ API
                const response = await fetch('https://api-xssearch.brid.pw/api/search/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        keyword: document.querySelector('input[name="test"]').value,
                        turnstile_token: turnstileToken
                    })
                });
                
                const result = await response.text();
                console.log('ğŸ“Š å¾Œç«¯å›æ‡‰:', result);
                
                document.getElementById('result').innerHTML = `
                    <h3>å¾Œç«¯å›æ‡‰:</h3>
                    <pre style="background: #f5f5f5; padding: 10px; border-radius: 5px;">${result}</pre>
                `;
                
            } catch (error) {
                console.error('âŒ API è«‹æ±‚éŒ¯èª¤:', error);
                document.getElementById('result').innerHTML = `<p style="color: red;">âŒ API è«‹æ±‚å¤±æ•—: ${error.message}</p>`;
            }
        });
        
        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        window.addEventListener('load', initTurnstile);
    </script>
</body>
</html>